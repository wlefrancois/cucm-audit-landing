<script>
(function () {
  var fired = false;

  function fire() {
    if (fired) return;
    fired = true;
    if (typeof plausible === "function") {
      plausible("Waitlist Signup");
    }
  }

  // Watch for DOM changes (Kit is dynamic)
  var obs = new MutationObserver(function () {
    // 1) If the form is replaced by a success message area
    var successByText = document.body && document.body.innerText && (
      document.body.innerText.includes("Success!") ||
      document.body.innerText.includes("confirm your subscription") ||
      document.body.innerText.includes("You're subscribed") ||
      document.body.innerText.includes("Thanks for") ||
      document.body.innerText.includes("Thank you")
    );

    // 2) If Kit adds a success alert element
    var successAlert = document.querySelector(".formkit-alert-success");

    // 3) If the submit button has finished and the form shows success UI
    // (Kit often toggles attributes/classes)
    var formHasSuccessState = document.querySelector('[data-element="success"], [data-group="success"]');

    if (successByText || successAlert || formHasSuccessState) {
      fire();
    }
  });

  obs.observe(document.documentElement, { childList: true, subtree: true });

  // Also try to catch the actual submit event (works in some embeds)
  document.addEventListener("submit", function (e) {
    try {
      var form = e.target;
      if (form && form.classList && form.classList.contains("formkit-form")) {
        // Don't fire here immediately; wait for success UI to appear
        // (keeps false positives low)
        setTimeout(function(){ /* observer will catch success */ }, 300);
      }
    } catch (err) {}
  }, true);
})();
</script>
